/**
 * pacem v0.9.0-byblos (https://js.pacem.it)
 * Copyright 2020 Pacem (https://pacem.it)
 * Licensed under MIT
 */
var Pacem,__decorate=this&&this.__decorate||function(e,t,i,a){var s,n=arguments.length,r=n<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,a);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(r=(n<3?s(r):n>3?s(t,i,r):s(t,i))||r);return n>3&&r&&Object.defineProperty(t,i,r),r};!function(e){!function(t){function i(e){return"stage"in e}function a(e){return i(e)}t.isDrawable=i,t.isUiObject=a,t.isShape=function(e){return"pathData"in e&&a(e)};t.DragEvent=class DragEvent extends CustomEvent{};t.DrawableEvent=class DrawableEvent extends e.CustomUIEvent{constructor(e,t,i){super(e,{detail:t,bubbles:!0,cancelable:!0},i)}}}(e.Drawing||(e.Drawing={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(i){i.TAG_MIDDLE_NAME="2d",i.TWO_PI=2*Math.PI;const a=Math.PI/180;i.Pacem2DAdapterElement=class Pacem2DAdapterElement extends t.PacemEventTarget{constructor(){super(...arguments),this.DefaultShapeValues={stroke:"#000",lineWidth:1,fill:"#fff"}}};class DrawableElement extends t.PacemCrossItemsContainerElement{findContainer(){return this.parent||this.stage}get stage(){return this._scene=this._scene||e.CustomElementUtils.findAncestorOfType(this,i.Pacem2DElement)}get parent(){return this._drawableParent=this._drawableParent||e.CustomElementUtils.findAncestor(this,e=>e instanceof DrawableElement)}disconnectedCallback(){delete this._scene,delete this._drawableParent,super.disconnectedCallback()}propertyChangedCallback(t,i,a,s){switch(super.propertyChangedCallback(t,i,a,s),t){case"hide":case"items":const n=this.stage;e.Utils.isNull(n)||("hide"===t?n.draw(this):n.requestDraw())}}}__decorate([e.Watch({emit:!1,reflectBack:!0,converter:e.PropertyConverters.String})],DrawableElement.prototype,"tag",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Boolean})],DrawableElement.prototype,"inert",void 0),i.DrawableElement=DrawableElement;class UiElement extends DrawableElement{constructor(){super(...arguments),this._transformMatrix=e.Matrix2D.identity}propertyChangedCallback(t,i,a,s){if(!s)switch(t){case"rotate":case"scaleX":case"scaleY":case"translateX":case"translateY":this._updateTransformMatrix();case"opacity":e.Utils.isNull(this.stage)||this.stage.draw(this)}}_updateTransformMatrix(){let e=a*(this.rotate||0),t=Math.cos(e),i=Math.sin(e),s=this.scaleX*t,n=-i,r=i,o=this.scaleY*t,l=this.translateX,c=this.translateY;this._transformMatrix={a:s,b:n,c:r,d:o,e:l,f:c}}get transformMatrix(){const e=this._transformMatrix;return{a:e.a,b:e.b,c:e.c,d:e.d,e:e.e,f:e.f}}}__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],UiElement.prototype,"rotate",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],UiElement.prototype,"scaleX",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],UiElement.prototype,"scaleY",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],UiElement.prototype,"translateX",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],UiElement.prototype,"translateY",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],UiElement.prototype,"opacity",void 0),i.UiElement=UiElement;class ShapeElement extends UiElement{validate(e){return!1}propertyChangedCallback(t,i,a,s){if(!s)switch(t){case"data":case"stroke":case"lineWidth":case"fill":e.Utils.isNull(this.stage)||this.stage.draw(this)}}viewActivatedCallback(){super.viewActivatedCallback(),this.data=this.getPathData()}get pathData(){return this.data}}__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],ShapeElement.prototype,"data",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],ShapeElement.prototype,"stroke",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],ShapeElement.prototype,"lineWidth",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],ShapeElement.prototype,"fill",void 0),i.ShapeElement=ShapeElement}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){var i;let a=i=class PacemCircleElement extends t.ShapeElement{propertyChangedCallback(e,t,i,a){if(super.propertyChangedCallback(e,t,i,a),!a)switch(e){case"center":case"radius":this.data=this.getPathData()}}getPathData(){const t=this.radius,a=this.center;return e.Utils.isNull(a)||e.Utils.isNull(t)?null:i.getPathData(a,t)}get boundingRect(){var e=this.center,t=this.radius,i=2*t;return{x:e.x-t,y:e.y-t,width:i,height:i}}static getPathData(e={x:NaN,y:NaN},t=NaN){const i=2*t;return`M ${e.x} ${e.y} m ${-t}, 0 a ${t},${t} 0 1,1 ${i},0 a ${t},${t} 0 1,1 ${-i},0`}};__decorate([e.Watch({converter:e.PropertyConverters.Json})],a.prototype,"center",void 0),__decorate([e.Watch({converter:e.PropertyConverters.Number})],a.prototype,"radius",void 0),a=i=__decorate([e.CustomElement({tagName:e.P+"-"+t.TAG_MIDDLE_NAME+"-circle"})],a),t.PacemCircleElement=a}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){let i=class PacemGroupElement extends t.DrawableElement{validate(e){return e instanceof t.DrawableElement&&e.parent===this}};i=__decorate([e.CustomElement({tagName:e.P+"-"+t.TAG_MIDDLE_NAME+"-group"})],i),t.PacemGroupElement=i}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){let i=class PacemPathElement extends t.ShapeElement{constructor(){super(...arguments),this.getPathData=(()=>this.d)}propertyChangedCallback(e,t,i,a){super.propertyChangedCallback(e,t,i,a),"d"===e&&(this.data=this.getPathData())}};__decorate([e.Watch({converter:e.PropertyConverters.String})],i.prototype,"d",void 0),__decorate([e.Watch({converter:e.PropertyConverters.Json})],i.prototype,"boundingRect",void 0),i=__decorate([e.CustomElement({tagName:e.P+"-"+t.TAG_MIDDLE_NAME+"-path"})],i),t.PacemPathElement=i}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){var i;let a=i=class PacemRectElement extends t.ShapeElement{propertyChangedCallback(e,t,i,a){super.propertyChangedCallback(e,t,i,a),a||"x"!==e&&"y"!==e&&"w"!==e&&"h"!==e||(this.data=this.getPathData())}getPathData(){const t=this.x,a=this.y,s=this.w,n=this.h;return e.Utils.isNull(t)||e.Utils.isNull(a)||e.Utils.isNull(s)||e.Utils.isNull(n)?null:i.getPathData(t,a,s,n)}get boundingRect(){return{x:this.x,y:this.y,width:this.w,height:this.h}}static getPathData(e=NaN,t=NaN,i=NaN,a=NaN){return`M ${e} ${t} h ${i} v ${a} h ${-i} z`}};__decorate([e.Watch({converter:e.PropertyConverters.Number})],a.prototype,"x",void 0),__decorate([e.Watch({converter:e.PropertyConverters.Number})],a.prototype,"y",void 0),__decorate([e.Watch({converter:e.PropertyConverters.Number})],a.prototype,"w",void 0),__decorate([e.Watch({converter:e.PropertyConverters.Number})],a.prototype,"h",void 0),a=i=__decorate([e.CustomElement({tagName:e.P+"-"+t.TAG_MIDDLE_NAME+"-rect"})],a),t.PacemRectElement=a}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(i){const a=/^\s*[xX]\s*([Mm](in|ax|id))\s*[yY]\s*([Mm](in|ax|id))(\s+(none|slice|meet))?\s*$/,s={convert:e=>{const t=a.exec(e);return t&&t.length>=4?{x:t[1].toLowerCase(),y:t[3].toLowerCase(),slice:"slice"===t[6]}:"none"},convertBack:t=>e.Utils.isNull(t)||"string"==typeof t?"none":`xM${t.x.substr(1)}YM${t.y.substr(1)} ${t.slice?"slice":"meet"}`};let n=class Pacem2DElement extends t.PacemItemsContainerElement{constructor(){super(...arguments),this._resize=(t=>{const i=this._size={width:t.detail.width,height:t.detail.height},a=this.adapter;e.Utils.isNull(a)||a.invalidateSize(this,i)}),this._zoomHandler=(t=>{if(e.CustomEventUtils.matchModifiers(t,e.EventKeyModifier.AltKey)){e.avoidHandler(t);const i=this._size,a=t.deltaY<0,s=this.viewbox||{x:0,y:0,width:i.width,height:i.height},n=.1,r=s.width*n,o=s.height*n;if(s.width+=r*(a?-1:1),s.height+=o*(a?-1:1),s.width>0&&s.height>0){const i=e.Utils.offsetRect(t.srcElement),n={x:t.clientX,y:t.clientY};n.x,i.x,i.width,n.y,i.y,i.height;s.x+=r*(a?1:-1),s.y+=o*(a?1:-1),this.viewbox={x:s.x,y:s.y,width:s.width,height:s.height}}}}),this._panHandler=(t=>{const i=this._panningStart,a=this._getPoint(t);if(!e.Utils.isNullOrEmpty(i&&i.point)&&!e.Utils.isNull(a)){const e=i.factor,t=i.box,s=i.point;this.viewbox={x:t.x-e*(a.x-s.x),y:t.y-e*(a.y-s.y),width:t.width,height:t.height}}}),this._panStartHandler=(t=>{const i=this._size,a=this.viewbox||{x:0,y:0,width:i.width,height:i.height},s=this._getPoint(t);s&&(e.avoidHandler(t),this._stage.style.pointerEvents="none",this._panningStart={point:s,box:a,factor:a.width/i.width})}),this._panEndHandler=(e=>{this._stage.style.pointerEvents="",this._panningStart=null})}get stage(){return this._stage}validate(t){return t instanceof i.DrawableElement&&e.Utils.isNull(t.parent)}draw(t){const i=this.adapter;if(!this.disabled&&!e.Utils.isNull(i)){let e=new CustomEvent("predraw",{cancelable:!0});this.dispatchEvent(e),e.defaultPrevented||(i.draw(this,t),this.dispatchEvent(new CustomEvent("draw")))}}_drawDebounced(){this.draw()}requestDraw(e){this._drawDebounced()}_buildUpDatasourceFromDOM(){this.datasource=(this.items||[]).slice()}_getPoint(t){return t instanceof MouseEvent&&e.CustomEventUtils.matchModifiers(t,e.EventKeyModifier.AltKey)?e.CustomEventUtils.getEventCoordinates(t).page:null}viewActivatedCallback(){super.viewActivatedCallback();const t=this.adapter;e.Utils.isNull(t)||(t.initialize(this),t.invalidateSize(this,this._size));const i=this._stage,a={capture:!1,passive:!0};i.addEventListener("wheel",this._zoomHandler,!1),i.addEventListener("mousedown",this._panStartHandler,!1),i.addEventListener("touchstart",this._panStartHandler,a),window.addEventListener("mousemove",this._panHandler,!1),window.addEventListener("mouseup",this._panEndHandler,!1),window.addEventListener("touchmove",this._panHandler,a),window.addEventListener("touchend",this._panEndHandler,a)}propertyChangedCallback(t,i,a,s){switch(super.propertyChangedCallback(t,i,a,s),t){case"adapter":e.Utils.isNull(i)||a.dispose(this),e.Utils.isNull(a)||a.initialize(this);break;case"aspectRatio":case"viewbox":e.Utils.isNull(this.adapter)||this.adapter.invalidateSize(this,this._size);break;case"items":this._buildUpDatasourceFromDOM();break;case"datasource":this._drawDebounced()}}disconnectedCallback(){const t=this._stage;e.Utils.isNull(t)||(t.removeEventListener("wheel",this._zoomHandler,!1),t.removeEventListener("mousedown",this._panStartHandler,!1),t.removeEventListener("touchstart",this._panStartHandler),window.removeEventListener("mousemove",this._panHandler,!1),window.removeEventListener("mouseup",this._panEndHandler,!1),window.removeEventListener("touchmove",this._panHandler),window.removeEventListener("touchend",this._panEndHandler)),e.Utils.isNull(this.adapter)||this.adapter.dispose(this),super.disconnectedCallback()}};__decorate([e.Watch({converter:e.PropertyConverters.Element})],n.prototype,"adapter",void 0),__decorate([e.Watch({emit:!1,reflectBack:!0,converter:e.PropertyConverters.Rect})],n.prototype,"viewbox",void 0),__decorate([e.Watch({emit:!1,reflectBack:!0,converter:s})],n.prototype,"aspectRatio",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Json})],n.prototype,"datasource",void 0),__decorate([e.ViewChild("."+e.PCSS+"-2d")],n.prototype,"_stage",void 0),__decorate([e.Debounce(!0)],n.prototype,"_drawDebounced",null),n=__decorate([e.CustomElement({tagName:e.P+"-"+i.TAG_MIDDLE_NAME,shadow:e.Defaults.USE_SHADOW_ROOT,template:`<${e.P}-resize target="{{ ::_stage }}" on-${t.ResizeEventName}=":host._resize($event)"></${e.P}-resize><div class="${e.PCSS}-2d"></div><pacem-content></pacem-content>`})],n),i.Pacem2DElement=n}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){Math.PI;function i(t){return"none"===t||e.Utils.isNullOrEmpty(t)}function a(t,i){return e.Utils.isNull(t)?i:t}let s=class PacemCanvasAdapterElement extends t.Pacem2DAdapterElement{constructor(){super(...arguments),this._pointer={page:{x:0,y:0},screen:{x:0,y:0},client:{x:0,y:0}},this._canvasOffset={x:0,y:0,width:0,height:0},this._clickHandler=(t=>{const i=this._hitTarget;e.Utils.isNull(i)||(i instanceof Element&&i.dispatchEvent(new e.Drawing.DrawableEvent("click",i,t)),i.stage.dispatchEvent(new e.Drawing.DrawableEvent("itemclick",i,t)))}),this._mousemoveHandler=(t=>{this._scopeEvent=t,this._pointer=e.CustomEventUtils.getEventCoordinates(t)}),this._touchstartHandler=(t=>{1===t.touches.length&&(this._scopeEvent=t,this._pointer=e.CustomEventUtils.getEventCoordinates(t))}),this._scenes=new WeakMap,this._handles=new WeakMap}invalidateSize(t,i){const a=this._scenes;if(!e.Utils.isNull(t)&&!e.Utils.isNullOrEmpty(i)&&a.has(t)){var s=a.get(t);s.canvas.width=i.width,s.canvas.height=i.height,this._canvasOffset=e.Utils.offsetRect(s.canvas)}}getHitTarget(t){const i=this._hitTarget;return e.Utils.isNull(i)||i.stage!==t?null:i}initialize(t){if(e.Utils.isNull(t))throw"Provided scene is null or undefined.";const i=this._scenes;if(i.has(t))return i.get(t).canvas;const a=t.stage;a.innerHTML="";var s=document.createElement("canvas"),n=s.getContext("2d");return s.addEventListener("mousemove",this._mousemoveHandler,!1),s.addEventListener("touchstart",this._touchstartHandler,{passive:!0}),s.addEventListener("touchmove",this._touchstartHandler,{passive:!0}),s.addEventListener("touchend",this._clickHandler,{passive:!0}),s.addEventListener("click",this._clickHandler,!1),a.appendChild(s),i.set(t,n),this._requestDraw(t),s}_requestDraw(e){const t=this._handles;t.has(e)&&cancelAnimationFrame(t.get(e)),t.set(e,requestAnimationFrame(()=>{this.draw(e)}))}dispose(e){const t=this._scenes;if(t.has(e)){var i=t.get(e);i.canvas.removeEventListener("click",this._clickHandler,!1),i.canvas.removeEventListener("touchend",this._clickHandler,!1),i.canvas.removeEventListener("touchmove",this._touchstartHandler),i.canvas.removeEventListener("touchstart",this._touchstartHandler),i.canvas.removeEventListener("mousemove",this._mousemoveHandler,!1),i.canvas.remove(),t.delete(e)}}draw(t){const i=this._scenes,a=this._handles;if(!e.Utils.isNull(t)){if(t.adapter!==this)return void(i.has(t)&&(i.delete(t),a.get(t)));if(!i.has(t))return void this.initialize(t);a.has(t)&&cancelAnimationFrame(a.get(t));const s=this._hitTarget,n=t.datasource||[];this._hitTarget=null;const r=i.get(t),o=r.canvas;r.clearRect(0,0,o.width,o.height),this._resetTransform(t.viewbox,r);for(let e of n)this._draw(r,e);const l=this._hitTarget;l!=s&&(e.Utils.isNull(s)||(s instanceof Element&&s.dispatchEvent(new e.Drawing.DrawableEvent("out",s,this._scopeEvent)),t.dispatchEvent(new e.Drawing.DrawableEvent("itemout",s,this._scopeEvent))),e.Utils.isNull(l)||(l instanceof Element&&l.dispatchEvent(new e.Drawing.DrawableEvent("over",l,this._scopeEvent)),t.dispatchEvent(new e.Drawing.DrawableEvent("itemover",l,this._scopeEvent)))),this._requestDraw(t)}}_resetTransform(t,i){i.resetTransform();const a=t,s=i.canvas;if(!e.Utils.isNull(a)){const e=s.width,t=s.height,n=1/Math.min(a.width/e,a.height/t);i.transform(n,0,0,n,e/2-n*a.x,t/2-n*a.y)}}_hasItems(t){return"items"in t&&e.Utils.isArray(t.items)}_draw(t,s){var n;const r=this.DefaultShapeValues;if(!e.Drawing.isDrawable(s)||!s.hide){if(!e.Utils.isNull(t)&&e.Drawing.isShape(s)&&!e.Utils.isNullOrEmpty(n=s.pathData)){t.strokeStyle=a(s.stroke,r.stroke),t.fillStyle=a(s.fill,r.fill),t.lineWidth=a(s.lineWidth,r.lineWidth),t.globalAlpha=a(s.opacity,1);let l=s.transformMatrix;e.Utils.isNull(l)||e.Matrix2D.isIdentity(l)||t.transform(l.a,l.b,l.c,l.d,l.e,l.f),t.beginPath();const c=!i(s.fill),h=!i(s.stroke);var o=new Path2D(n);const d=this._pointer,m=this._canvasOffset,p={x:d.page.x-m.x,y:d.page.y-m.y};s.inert||e.Utils.isNull(d)||(c&&t.isPointInPath(o,p.x,p.y)||h&&t.isPointInStroke(o,p.x,p.y))&&(this._hitTarget=s),h&&t.stroke(o),c&&t.fill(o),this._resetTransform(s.stage.viewbox,t)}if(e.Drawing.isDrawable(s)&&this._hasItems(s)&&!s.hide){if(e.Drawing.isUiObject(s)){const i=s.transformMatrix;e.Utils.isNull(i)||e.Matrix2D.isIdentity(i)||t.transform(i.a,i.b,i.c,i.d,i.e,i.f)}for(let e of s.items||[])this._draw(t,e)}}}};s=__decorate([e.CustomElement({tagName:e.P+"-"+t.TAG_MIDDLE_NAME+"-canvas-adapter"})],s),t.PacemCanvasAdapterElement=s}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){const i="http://www.w3.org/2000/svg";function a(t,i){return e.Utils.isNull(t)?i:t}let s=class PacemSvgAdapterElement extends t.Pacem2DAdapterElement{constructor(){super(...arguments),this._hitTarget=null,this._dragInitHandler=(t=>{const i=t.detail,a=i.element,s=e.CustomElementUtils.getAttachedPropertyValue(a,"pacem:drawable"),n=a.getScreenCTM().inverse(),r=e.Utils.deserializeTransform(a.style);i.data={transformMatrix:n,item:s,initialTransformMatrix:r},this._itemDispatch(s,t.type,{x:0,y:0})}),this._draggingHandler=(t=>{e.avoidHandler(t),this._dragging=!0;const i=t.detail.element,a=t.detail.data,s=t.detail,n={x:(s.currentPosition.x-s.origin.x)*a.transformMatrix.a+a.initialTransformMatrix.e,y:(s.currentPosition.y-s.origin.y)*a.transformMatrix.d+a.initialTransformMatrix.f};i.style.transform=`matrix(1,0,0,1,${n.x},${n.y})`,this._itemDispatch(a.item,t.type,n)}),this._dragEndHandler=(t=>{this._dragging=!1;const i=t.detail,a=i.data,s=e.Utils.deserializeTransform(i.element.style);this._itemDispatch(a.item,t.type,{x:s.e,y:s.f})}),this._mousemoveHandler=(t=>{var i=e.CustomEventUtils.getEventCoordinates(t).client;if(!this._dragging){var a=null,s=(document.elementsFromPoint(i.x,i.y).find(t=>(a=e.CustomElementUtils.getAttachedPropertyValue(t,"pacem:drawable"))&&!a.inert),this._hitTarget),n=a;(e.Utils.isNull(a&&a.stage)||!this._scenes.has(a.stage)||a.inert)&&(n=null),this._hitTarget=n,n!==s&&(e.Utils.isNull(s)||(this._dragger.unregister(this._items.get(s)),this._itemDispatch(s,"out",t)),e.Utils.isNull(n)||(n.draggable&&this._dragger.register(this._items.get(n)),this._itemDispatch(n,"over",t)))}}),this._mouseDownUpHandler=(t=>{if(!e.Utils.isNull(this._hitTarget)){const e=t.type.replace(/^mouse/,"");this._itemDispatch(this._hitTarget,e,t)}}),this._scenes=new WeakMap,this._items=new WeakMap}viewActivatedCallback(){super.viewActivatedCallback();const t=this._dragger=document.createElement(e.P+"-drag-drop");t.mode=e.UI.DragDataMode.Self,e.CustomElementUtils.findAncestorShell(this).appendChild(t),t.addEventListener(e.UI.DragDropEventType.Init,this._dragInitHandler,!1),t.addEventListener(e.UI.DragDropEventType.Drag,this._draggingHandler,!1),t.addEventListener(e.UI.DragDropEventType.End,this._dragEndHandler,!1)}disconnectedCallback(){const t=this._dragger;e.Utils.isNull(t)||(t.removeEventListener(e.UI.DragDropEventType.Init,this._dragInitHandler,!1),t.removeEventListener(e.UI.DragDropEventType.Drag,this._draggingHandler,!1),t.removeEventListener(e.UI.DragDropEventType.End,this._dragEndHandler,!1),t.remove()),super.disconnectedCallback()}invalidateSize(t,i){const a=this._scenes;if(!e.Utils.isNull(t)&&!e.Utils.isNullOrEmpty(i)&&a.has(t)){var s=a.get(t);s.setAttribute("width",i.width+""),s.setAttribute("height",i.height+"");const n=t.viewbox,r=t.aspectRatio;e.Utils.isNullOrEmpty(n)?s.removeAttribute("viewBox"):s.setAttribute("viewBox",`${n.x} ${n.y} ${n.width} ${n.height}`),e.Utils.isNullOrEmpty(r)||"string"==typeof r?s.removeAttribute("preserveAspectRatio"):s.setAttribute("preserveAspectRatio",`xM${r.x.substr(1)}YM${r.y.substr(1)} ${r.slice?"slice":"meet"}`)}}initialize(t){if(e.Utils.isNull(t))throw"Provided scene is null or undefined.";const a=this._scenes;if(a.has(t))return a.get(t);const s=t.stage;s.innerHTML="",this._items=new WeakMap;var n=document.createElementNS(i,"svg");s.appendChild(n),a.set(t,n);return n.addEventListener("mousemove",this._mousemoveHandler,!1),n.addEventListener("click",this._mouseDownUpHandler,!1),n.addEventListener("mousedown",this._mouseDownUpHandler,!1),n.addEventListener("mouseup",this._mouseDownUpHandler,!1),this.draw(t),n}dispose(e){const t=this._scenes;if(t.has(e)){var i=t.get(e);i.removeEventListener("mousemove",this._mousemoveHandler),i.removeEventListener("click",this._mouseDownUpHandler),i.removeEventListener("mousedown",this._mouseDownUpHandler),i.removeEventListener("mouseup",this._mouseDownUpHandler),i.remove(),t.delete(e)}}getHitTarget(e){return this._hitTarget}draw(t,i){const a=this._scenes,s=this._items;if(!e.Utils.isNull(t))if(t.adapter===this){a.has(t)||this.initialize(t);var n=t.datasource,r=!0,o=a.get(t);e.Utils.isNull(i)||s.has(i)&&(n=[i],o=s.get(i).parentNode,r=!1),r&&(o.innerHTML=""),this._draw(o,n||[],r)}else a.has(t)&&a.delete(t)}_itemDispatch(t,i,a){if(!e.Utils.isNull(t)){var s,n;a instanceof Event?n=a:s={item:t,offset:a};const r=()=>a instanceof Event?new e.Drawing.DrawableEvent(i,t,n):new e.Drawing.DragEvent(i,{detail:s}),o=a instanceof Event?new e.Drawing.DrawableEvent("item"+i,t,n):new e.Drawing.DragEvent("item"+i,{detail:s});t instanceof EventTarget&&t.dispatchEvent(r()),t.stage.dispatchEvent(o)}}_hasItems(t){return"items"in t&&e.Utils.isArray(t.items)}_draw(t,i,s){const n=this._items;let r=0;if(!e.Utils.isNullOrEmpty(i))for(let o of i){let i;if(n.has(o)?(i=n.get(o)).parentNode!==t&&t.appendChild(i):(i=this._buildSVGElement(o),e.CustomElementUtils.setAttachedPropertyValue(i,"pacem:drawable",o),t.appendChild(i),n.set(o,i)),e.Drawing.isDrawable(o)&&(o.hide?i.setAttribute("display","none"):i.removeAttribute("display"),i.style.transform="none"),e.Drawing.isShape(o)){const e=i,t=this.DefaultShapeValues;e.setAttribute("d",a(o.pathData,"M0,0")),e.setAttribute("fill",a(o.fill,t.fill)),e.setAttribute("stroke",a(o.stroke,t.stroke)),e.setAttribute("stroke-width",""+a(o.lineWidth,t.lineWidth))}if(e.Drawing.isUiObject(o)){const t=o.transformMatrix;e.Utils.isNull(t)||e.Matrix2D.isIdentity(t)?i.removeAttribute("transform"):i.setAttribute("transform",`matrix(${t.a} ${t.b} ${t.c} ${t.d} ${t.e} ${t.f})`);const s=a(o.opacity,1);1===s?i.removeAttribute("opacity"):i.setAttribute("opacity",""+s)}s&&this._hasItems(o)&&this._draw(i,o.items,s),r++}if(s)for(let e=t.children.length-1;e>=r;e--){t.children.item(e).remove()}}_buildSVGElement(t){return e.Drawing.isShape(t)?document.createElementNS(i,"path"):document.createElementNS(i,"g")}};s=__decorate([e.CustomElement({tagName:e.P+"-"+t.TAG_MIDDLE_NAME+"-svg-adapter"})],s),t.PacemSvgAdapterElement=s}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={}));